import express from 'express';
import serverless from 'serverless-http';
import { join } from 'path';
const fileName = 'timeStamp';
const path = '/.netlify/functions/';

const app = express();

// enable CORS (https://en.wikipedia.org/wiki/Cross-origin_resource_sharing)
// so that your API is remotely testable by FCC
var cors = require('cors');
app.use(cors({ optionsSuccessStatus: 200 })); // some legacy browsers choke on 204

// http://expressjs.com/en/starter/static-files.html
app.use('/public', express.static(join(__dirname, '../public/')));

const router = express.Router();

router.get('/:date_string?', (req, res) => {
	var reqDate = new Date(req.params.date_string);
	var responseDate = !isNaN(reqDate.getTime()) ? reqDate : new Date();

	var response = {
		unix: responseDate.getTime(),
		utc: responseDate.toUTCString(),
	};
	return res.json(response);
});

app.get(
	path + fileName.toLowerCase() + '/api' + fileName.toLowerCase(),
	router,
); // path must route to lambda
app.use(path + fileName.toLowerCase(), (_, res) => {
	res.write(
		`<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    </head>
    <body>
        timeStamp
    </body>
    </html>`,
	);
	res.end();
});
module.exports = app;
module.exports.handler = serverless(app);
